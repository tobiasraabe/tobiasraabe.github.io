{"pages":[{"title":"Projects","text":"Research Malleability of Locus of Control This research project is concerned with a person's Locus of Control which is the degree to which people believe that they have control over the outcome of events in their lives. We use the GSOEP (German Socio-Economic Panel) from 2005-2015 and estimate in a difference-and-difference design the changes in Locus of Control due to potentially exogenous and negative events like death of a close relative. The reasoning is that sudden, negative events raise the salience of lack of power which might push the individual towards a more external Locus of Control. External in contrast to internal Locus of Control means that the individual believes outcomes cannot be controlled by the individual whereas internal means the opposite. Paper Project on Github Cryptocurrency Market Prediction The project is about market prediction in cryptocurrency markets like Potcoin and was developed during a programing class for economists which focused on the embedding of the research project in a Waf framework. Waf is an automation tool for software design. Project on Github Software Engineering oTree Virtual Machine Manager This tool is designed to handle many administrative tasks on a server with multiple running oTree instances. In addition to that, multiple virtual machine images are provided based on the hosts performance and administrator's needs. Project on Github Documentation","tags":"pages","url":"projects.html"},{"title":"How to download files with Python","text":"TL;DR: A short script in python to download files, resume downloads and to validate downloads with hash values. You can find it at the end of the article. /*! * * IPython notebook * */ /* CSS font colors for translated ANSI colors. */ .ansibold { font-weight: bold; } /* use dark versions for foreground, to improve visibility */ .ansiblack { color: black; } .ansired { color: darkred; } .ansigreen { color: darkgreen; } .ansiyellow { color: #c4a000; } .ansiblue { color: darkblue; } .ansipurple { color: darkviolet; } .ansicyan { color: steelblue; } .ansigray { color: gray; } /* and light for background, for the same reason */ .ansibgblack { background-color: black; } .ansibgred { background-color: red; } .ansibggreen { background-color: green; } .ansibgyellow { background-color: yellow; } .ansibgblue { background-color: blue; } .ansibgpurple { background-color: magenta; } .ansibgcyan { background-color: cyan; } .ansibggray { background-color: gray; } div.cell { /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; /* This acts as a spacer between cells, that is outside the border */ margin: 0px; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); } div.cell.jupyter-soft-selected { border-left-color: #90CAF9; border-left-color: #E3F2FD; border-left-width: 1px; padding-left: 5px; border-right-color: #E3F2FD; border-right-width: 1px; background: #E3F2FD; } @media print { div.cell.jupyter-soft-selected { border-color: transparent; } } div.cell.selected { border-color: #ababab; border-left-width: 0px; padding-left: 6px; background: linear-gradient(to right, #42A5F5 -40px, #42A5F5 5px, transparent 5px, transparent 100%); } @media print { div.cell.selected { border-color: transparent; } } div.cell.selected.jupyter-soft-selected { border-left-width: 0; padding-left: 6px; background: linear-gradient(to right, #42A5F5 -40px, #42A5F5 7px, #E3F2FD 7px, #E3F2FD 100%); } .edit_mode div.cell.selected { border-color: #66BB6A; border-left-width: 0px; padding-left: 6px; background: linear-gradient(to right, #66BB6A -40px, #66BB6A 5px, transparent 5px, transparent 100%); } @media print { .edit_mode div.cell.selected { border-color: transparent; } } .prompt { /* This needs to be wide enough for 3 digit prompt numbers: In[100]: */ min-width: 14ex; /* This padding is tuned to match the padding on the CodeMirror editor. */ padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; /* This has to match that of the the CodeMirror class line-height below */ line-height: 1.21429em; /* Don't highlight prompt number selection */ -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; /* Use default cursor */ cursor: default; } @media (max-width: 540px) { .prompt { text-align: left; } } div.inner_cell { min-width: 0; /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; /* Old browsers */ -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; /* Modern browsers */ flex: 1; } /* input_area and input_prompt must match in top border and margin for alignment */ div.input_area { border: 1px solid #cfcfcf; border-radius: 2px; background: #f7f7f7; line-height: 1.21429em; } /* This is needed so that empty prompt areas can collapse to zero height when there is no content in the output_subarea and the prompt. The main purpose of this is to make sure that empty JavaScript output_subareas have no height. */ div.prompt:empty { padding-top: 0; padding-bottom: 0; } div.unrecognized_cell { padding: 5px 5px 5px 0px; /* Old browsers */ display: -webkit-box; -webkit-box-orient: horizontal; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: horizontal; -moz-box-align: stretch; display: box; box-orient: horizontal; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: row; align-items: stretch; } div.unrecognized_cell .inner_cell { border-radius: 2px; padding: 5px; font-weight: bold; color: red; border: 1px solid #cfcfcf; background: #eaeaea; } div.unrecognized_cell .inner_cell a { color: inherit; text-decoration: none; } div.unrecognized_cell .inner_cell a:hover { color: inherit; text-decoration: none; } @media (max-width: 540px) { div.unrecognized_cell > div.prompt { display: none; } } div.code_cell { /* avoid page breaking on code cells when printing */ } @media print { div.code_cell { page-break-inside: avoid; } } /* any special styling for code cells that are currently running goes here */ div.input { page-break-inside: avoid; /* Old browsers */ display: -webkit-box; -webkit-box-orient: horizontal; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: horizontal; -moz-box-align: stretch; display: box; box-orient: horizontal; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: row; align-items: stretch; } @media (max-width: 540px) { div.input { /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; } } /* input_area and input_prompt must match in top border and margin for alignment */ div.input_prompt { color: #303F9F; border-top: 1px solid transparent; } div.input_area > div.highlight { margin: 0.4em; border: none; padding: 0px; background-color: transparent; } div.input_area > div.highlight > pre { margin: 0px; border: none; padding: 0px; background-color: transparent; } /* The following gets added to the <head> if it is detected that the user has a * monospace font with inconsistent normal/bold/italic height. See * notebookmain.js. Such fonts will have keywords vertically offset with * respect to the rest of the text. The user should select a better font. * See: https://github.com/ipython/ipython/issues/1503 * * .CodeMirror span { * vertical-align: bottom; * } */ .CodeMirror { line-height: 1.21429em; /* Changed from 1em to our global default */ font-size: 14px; height: auto; /* Changed to auto to autogrow */ background: none; /* Changed from white to allow our bg to show through */ } .CodeMirror-scroll { /* The CodeMirror docs are a bit fuzzy on if overflow-y should be hidden or visible.*/ /* We have found that if it is visible, vertical scrollbars appear with font size changes.*/ overflow-y: hidden; overflow-x: auto; } .CodeMirror-lines { /* In CM2, this used to be 0.4em, but in CM3 it went to 4px. We need the em value because */ /* we have set a different line-height and want this to scale with that. */ padding: 0.4em; } .CodeMirror-linenumber { padding: 0 8px 0 4px; } .CodeMirror-gutters { border-bottom-left-radius: 2px; border-top-left-radius: 2px; } .CodeMirror pre { /* In CM3 this went to 4px from 0 in CM2. We need the 0 value because of how we size */ /* .CodeMirror-lines */ padding: 0; border: 0; border-radius: 0; } /* Original style from softwaremaniacs.org (c) Ivan Sagalaev <Maniac@SoftwareManiacs.Org> Adapted from GitHub theme */ .highlight-base { color: #000; } .highlight-variable { color: #000; } .highlight-variable-2 { color: #1a1a1a; } .highlight-variable-3 { color: #333333; } .highlight-string { color: #BA2121; } .highlight-comment { color: #408080; font-style: italic; } .highlight-number { color: #080; } .highlight-atom { color: #88F; } .highlight-keyword { color: #008000; font-weight: bold; } .highlight-builtin { color: #008000; } .highlight-error { color: #f00; } .highlight-operator { color: #AA22FF; font-weight: bold; } .highlight-meta { color: #AA22FF; } /* previously not defined, copying from default codemirror */ .highlight-def { color: #00f; } .highlight-string-2 { color: #f50; } .highlight-qualifier { color: #555; } .highlight-bracket { color: #997; } .highlight-tag { color: #170; } .highlight-attribute { color: #00c; } .highlight-header { color: blue; } .highlight-quote { color: #090; } .highlight-link { color: #00c; } /* apply the same style to codemirror */ .cm-s-ipython span.cm-keyword { color: #008000; font-weight: bold; } .cm-s-ipython span.cm-atom { color: #88F; } .cm-s-ipython span.cm-number { color: #080; } .cm-s-ipython span.cm-def { color: #00f; } .cm-s-ipython span.cm-variable { color: #000; } .cm-s-ipython span.cm-operator { color: #AA22FF; font-weight: bold; } .cm-s-ipython span.cm-variable-2 { color: #1a1a1a; } .cm-s-ipython span.cm-variable-3 { color: #333333; } .cm-s-ipython span.cm-comment { color: #408080; font-style: italic; } .cm-s-ipython span.cm-string { color: #BA2121; } .cm-s-ipython span.cm-string-2 { color: #f50; } .cm-s-ipython span.cm-meta { color: #AA22FF; } .cm-s-ipython span.cm-qualifier { color: #555; } .cm-s-ipython span.cm-builtin { color: #008000; } .cm-s-ipython span.cm-bracket { color: #997; } .cm-s-ipython span.cm-tag { color: #170; } .cm-s-ipython span.cm-attribute { color: #00c; } .cm-s-ipython span.cm-header { color: blue; } .cm-s-ipython span.cm-quote { color: #090; } .cm-s-ipython span.cm-link { color: #00c; } .cm-s-ipython span.cm-error { color: #f00; } .cm-s-ipython span.cm-tab { background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAAXNSR0IArs4c6QAAAGFJREFUSMft1LsRQFAQheHPowAKoACx3IgEKtaEHujDjORSgWTH/ZOdnZOcM/sgk/kFFWY0qV8foQwS4MKBCS3qR6ixBJvElOobYAtivseIE120FaowJPN75GMu8j/LfMwNjh4HUpwg4LUAAAAASUVORK5CYII=); background-position: right; background-repeat: no-repeat; } div.output_wrapper { /* this position must be relative to enable descendents to be absolute within it */ position: relative; /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; z-index: 1; } /* class for the output area when it should be height-limited */ div.output_scroll { /* ideally, this would be max-height, but FF barfs all over that */ height: 24em; /* FF needs this *and the wrapper* to specify full width, or it will shrinkwrap */ width: 100%; overflow: auto; border-radius: 2px; -webkit-box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8); box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8); display: block; } /* output div while it is collapsed */ div.output_collapsed { margin: 0px; padding: 0px; /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; } div.out_prompt_overlay { height: 100%; padding: 0px 0.4em; position: absolute; border-radius: 2px; } div.out_prompt_overlay:hover { /* use inner shadow to get border that is computed the same on WebKit/FF */ -webkit-box-shadow: inset 0 0 1px #000; box-shadow: inset 0 0 1px #000; background: rgba(240, 240, 240, 0.5); } div.output_prompt { color: #D84315; } /* This class is the outer container of all output sections. */ div.output_area { padding: 0px; page-break-inside: avoid; /* Old browsers */ display: -webkit-box; -webkit-box-orient: horizontal; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: horizontal; -moz-box-align: stretch; display: box; box-orient: horizontal; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: row; align-items: stretch; } div.output_area .MathJax_Display { text-align: left !important; } div.output_area div.output_area div.output_area img, div.output_area svg { max-width: 100%; height: auto; } div.output_area img.unconfined, div.output_area svg.unconfined { max-width: none; } /* This is needed to protect the pre formating from global settings such as that of bootstrap */ .output { /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; } @media (max-width: 540px) { div.output_area { /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; } } div.output_area pre { margin: 0; padding: 0; border: 0; vertical-align: baseline; color: black; background-color: transparent; border-radius: 0; } /* This class is for the output subarea inside the output_area and after the prompt div. */ div.output_subarea { overflow-x: auto; padding: 0.4em; /* Old browsers */ -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; /* Modern browsers */ flex: 1; max-width: calc(100% - 14ex); } div.output_scroll div.output_subarea { overflow-x: visible; } /* The rest of the output_* classes are for special styling of the different output types */ /* all text output has this class: */ div.output_text { text-align: left; color: #000; /* This has to match that of the the CodeMirror class line-height below */ line-height: 1.21429em; } /* stdout/stderr are 'text' as well as 'stream', but execute_result/error are *not* streams */ div.output_stderr { background: #fdd; /* very light red background for stderr */ } div.output_latex { text-align: left; } /* Empty output_javascript divs should have no height */ div.output_javascript:empty { padding: 0; } .js-error { color: darkred; } /* raw_input styles */ div.raw_input_container { line-height: 1.21429em; padding-top: 5px; } pre.raw_input_prompt { /* nothing needed here. */ } input.raw_input { font-family: monospace; font-size: inherit; color: inherit; width: auto; /* make sure input baseline aligns with prompt */ vertical-align: baseline; /* padding + margin = 0.5em between prompt and cursor */ padding: 0em 0.25em; margin: 0em 0.25em; } input.raw_input:focus { box-shadow: none; } p.p-space { margin-bottom: 10px; } div.output_unrecognized { padding: 5px; font-weight: bold; color: red; } div.output_unrecognized a { color: inherit; text-decoration: none; } div.output_unrecognized a:hover { color: inherit; text-decoration: none; } .rendered_html { color: #000; /* any extras will just be numbers: */ } .rendered_html :link { text-decoration: underline; } .rendered_html :visited { text-decoration: underline; } .rendered_html h1:first-child { margin-top: 0.538em; } .rendered_html h2:first-child { margin-top: 0.636em; } .rendered_html h3:first-child { margin-top: 0.777em; } .rendered_html h4:first-child { margin-top: 1em; } .rendered_html h5:first-child { margin-top: 1em; } .rendered_html h6:first-child { margin-top: 1em; } .rendered_html * + ul { margin-top: 1em; } .rendered_html * + ol { margin-top: 1em; } .rendered_html pre, .rendered_html tr, .rendered_html th, .rendered_html td, .rendered_html * + table { margin-top: 1em; } .rendered_html * + p { margin-top: 1em; } .rendered_html * + img { margin-top: 1em; } .rendered_html img, .rendered_html img.unconfined, div.text_cell { /* Old browsers */ display: -webkit-box; -webkit-box-orient: horizontal; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: horizontal; -moz-box-align: stretch; display: box; box-orient: horizontal; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: row; align-items: stretch; } @media (max-width: 540px) { div.text_cell > div.prompt { display: none; } } div.text_cell_render { /*font-family: \"Helvetica Neue\", Arial, Helvetica, Geneva, sans-serif;*/ outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; } a.anchor-link:link { text-decoration: none; padding: 0px 20px; visibility: hidden; } h1:hover .anchor-link, h2:hover .anchor-link, h3:hover .anchor-link, h4:hover .anchor-link, h5:hover .anchor-link, h6:hover .anchor-link { visibility: visible; } .text_cell.rendered .input_area { display: none; } .text_cell.rendered .text_cell.unrendered .text_cell_render { display: none; } .cm-header-1, .cm-header-2, .cm-header-3, .cm-header-4, .cm-header-5, .cm-header-6 { font-weight: bold; font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif; } .cm-header-1 { font-size: 185.7%; } .cm-header-2 { font-size: 157.1%; } .cm-header-3 { font-size: 128.6%; } .cm-header-4 { font-size: 110%; } .cm-header-5 { font-size: 100%; font-style: italic; } .cm-header-6 { font-size: 100%; font-style: italic; } .highlight .hll { background-color: #ffffcc } .highlight { background: #f8f8f8; } .highlight .c { color: #408080; font-style: italic } /* Comment */ .highlight .err { border: 1px solid #FF0000 } /* Error */ .highlight .k { color: #008000; font-weight: bold } /* Keyword */ .highlight .o { color: #666666 } /* Operator */ .highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */ .highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */ .highlight .cp { color: #BC7A00 } /* Comment.Preproc */ .highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */ .highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */ .highlight .cs { color: #408080; font-style: italic } /* Comment.Special */ .highlight .gd { color: #A00000 } /* Generic.Deleted */ .highlight .ge { font-style: italic } /* Generic.Emph */ .highlight .gr { color: #FF0000 } /* Generic.Error */ .highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */ .highlight .gi { color: #00A000 } /* Generic.Inserted */ .highlight .go { color: #888888 } /* Generic.Output */ .highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */ .highlight .gs { font-weight: bold } /* Generic.Strong */ .highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */ .highlight .gt { color: #0044DD } /* Generic.Traceback */ .highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */ .highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */ .highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */ .highlight .kp { color: #008000 } /* Keyword.Pseudo */ .highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */ .highlight .kt { color: #B00040 } /* Keyword.Type */ .highlight .m { color: #666666 } /* Literal.Number */ .highlight .s { color: #BA2121 } /* Literal.String */ .highlight .na { color: #7D9029 } /* Name.Attribute */ .highlight .nb { color: #008000 } /* Name.Builtin */ .highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */ .highlight .no { color: #880000 } /* Name.Constant */ .highlight .nd { color: #AA22FF } /* Name.Decorator */ .highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */ .highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */ .highlight .nf { color: #0000FF } /* Name.Function */ .highlight .nl { color: #A0A000 } /* Name.Label */ .highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */ .highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */ .highlight .nv { color: #19177C } /* Name.Variable */ .highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */ .highlight .w { color: #bbbbbb } /* Text.Whitespace */ .highlight .mb { color: #666666 } /* Literal.Number.Bin */ .highlight .mf { color: #666666 } /* Literal.Number.Float */ .highlight .mh { color: #666666 } /* Literal.Number.Hex */ .highlight .mi { color: #666666 } /* Literal.Number.Integer */ .highlight .mo { color: #666666 } /* Literal.Number.Oct */ .highlight .sa { color: #BA2121 } /* Literal.String.Affix */ .highlight .sb { color: #BA2121 } /* Literal.String.Backtick */ .highlight .sc { color: #BA2121 } /* Literal.String.Char */ .highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */ .highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */ .highlight .s2 { color: #BA2121 } /* Literal.String.Double */ .highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */ .highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */ .highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */ .highlight .sx { color: #008000 } /* Literal.String.Other */ .highlight .sr { color: #BB6688 } /* Literal.String.Regex */ .highlight .s1 { color: #BA2121 } /* Literal.String.Single */ .highlight .ss { color: #19177C } /* Literal.String.Symbol */ .highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */ .highlight .fm { color: #0000FF } /* Name.Function.Magic */ .highlight .vc { color: #19177C } /* Name.Variable.Class */ .highlight .vg { color: #19177C } /* Name.Variable.Global */ .highlight .vi { color: #19177C } /* Name.Variable.Instance */ .highlight .vm { color: #19177C } /* Name.Variable.Magic */ .highlight .il { color: #666666 } /* Literal.Number.Integer.Long */ /* Temporary definitions which will become obsolete with Notebook release 5.0 */ .ansi-black-fg { color: #3E424D; } .ansi-black-bg { background-color: #3E424D; } .ansi-black-intense-fg { color: #282C36; } .ansi-black-intense-bg { background-color: #282C36; } .ansi-red-fg { color: #E75C58; } .ansi-red-bg { background-color: #E75C58; } .ansi-red-intense-fg { color: #B22B31; } .ansi-red-intense-bg { background-color: #B22B31; } .ansi-green-fg { color: #00A250; } .ansi-green-bg { background-color: #00A250; } .ansi-green-intense-fg { color: #007427; } .ansi-green-intense-bg { background-color: #007427; } .ansi-yellow-fg { color: #DDB62B; } .ansi-yellow-bg { background-color: #DDB62B; } .ansi-yellow-intense-fg { color: #B27D12; } .ansi-yellow-intense-bg { background-color: #B27D12; } .ansi-blue-fg { color: #208FFB; } .ansi-blue-bg { background-color: #208FFB; } .ansi-blue-intense-fg { color: #0065CA; } .ansi-blue-intense-bg { background-color: #0065CA; } .ansi-magenta-fg { color: #D160C4; } .ansi-magenta-bg { background-color: #D160C4; } .ansi-magenta-intense-fg { color: #A03196; } .ansi-magenta-intense-bg { background-color: #A03196; } .ansi-cyan-fg { color: #60C6C8; } .ansi-cyan-bg { background-color: #60C6C8; } .ansi-cyan-intense-fg { color: #258F8F; } .ansi-cyan-intense-bg { background-color: #258F8F; } .ansi-white-fg { color: #C5C1B4; } .ansi-white-bg { background-color: #C5C1B4; } .ansi-white-intense-fg { color: #A1A6B2; } .ansi-white-intense-bg { background-color: #A1A6B2; } .ansi-bold { font-weight: bold; } In one of my recent projects on natural language processing and patents, I tried to program a little script which downloads files needed for the analysis. The program should be able to do the following things: Download a given file Resume the download if the file is incomplete Validate the file at the end of the download using hashes Wrap everything with beautiful progress bars Note that, to run the script you have to have at least a python 3.6 environment as I am using f-strings . Downloading files At first, we need to know how to download a file. We will use requests to handle connections to web content. In [1]: import requests In the next step, we will download a file and store it on the disk. The file size is 19kb, so you are save to download it. If you have doubts about the file, insert any other link which can be a picture or something else. In [2]: url = 'http://www.patentsview.org/data/20171226/cpc_group.tsv.zip' r = requests . get ( url ) with open ( 'cpc_group.tsv.zip' , 'wb' ) as f : f . write ( r . content ) Note that requests.get will download the file immediately and store it in memory. For larger files, this does not work as they might not fit in memory. Therefore, we use the stream keyword to receive the file in chunks and store them on disk. The next file is about 3MB big. Use a different URL if you feel more comfortable with that. In [3]: url = 'http://www.patentsview.org/data/20171226/government_interest.tsv.zip' r = requests . get ( url , stream = True ) with open ( 'government_interest.tsv.zip' , 'wb' ) as f : for chunk in r . iter_content ( 32 * 1024 ): f . write ( chunk ) Resuming downloads If you download large files, chances are that your download is interrupted. For that, we need a way to resume the download at the last byte position. We can do that by sending an Range-request to the server and specifying the range of bytes, we want to receive. In [4]: resume_header = ({ 'Range' : f 'bytes=0-2000000' }) r = requests . get ( url , stream = True , headers = resume_header ) with open ( 'government_interest_part.tsv.zip' , 'wb' ) as f : for chunk in r . iter_content ( 32 * 1024 ): f . write ( chunk ) We look at the file size whether we have been able to download the file partially. In [5]: from pathlib import Path path = Path ( 'government_interest_part.tsv.zip' ) print ( f 'Size of file: {path.stat().st_size} Bytes' ) Size of file: 2000001 Bytes Now, we resume the download at the position of the last byte. We also have to change the mode from open() to 'ab' as we are appending new content and do not want to overwrite existing content. In [6]: resume_header = ({ 'Range' : f 'bytes={path.stat().st_size}-' }) r = requests . get ( url , stream = True , headers = resume_header ) with open ( 'government_interest_part.tsv.zip' , 'ab' ) as f : for chunk in r . iter_content ( 32 * 1024 ): f . write ( chunk ) The crucial aspect of this code is that we correctly define the following range of bytes for the following downloads. It is important to know that the boundaries of the Range header are inclusive so that bytes in positions 0 and 2000000 are downloaded. Therefore, the file size is 2000001 and we can plug in the value to correctly resume the download. Validating downloads At last, we want to make sure that the download of the file worked as expected. To assert whether two files are identical, one of the easiest solutions is to compare hashes. A hash function projects any kind of data onto data with fixed-length. The resulting object is called hash and should be different for two different objects but identical for the same. In this example, we use SHA256 to validate the two files. In [7]: import hashlib with open ( 'government_interest.tsv.zip' , 'rb' ) as f : content = f . read () sha = hashlib . sha256 () sha . update ( content ) print ( sha . hexdigest ()) 42e53da0f2adc03e035eb2f967998da5cb8e2b1235cd2630efc59e31df866372 In [8]: with open ( 'government_interest_part.tsv.zip' , 'rb' ) as f : content = f . read () sha = hashlib . sha256 () sha . update ( content ) print ( sha . hexdigest ()) 42e53da0f2adc03e035eb2f967998da5cb8e2b1235cd2630efc59e31df866372 Both hashes match and we have correctly resumed the download :). Visualizing download progress There are multiple options to print pretty progress bars in python to the command line interface ( progressbar2 e.g.), but I used tqdm for unknown reason. To display the progress of the download, we have to know the total file size which we can easily request without downloading the whole file. Use requests.head() instead of requests.get() . In [9]: url = 'http://www.patentsview.org/data/20171226/government_interest.tsv.zip' r = requests . head ( url ) file_size = int ( r . headers . get ( 'content-length' , 0 )) print ( f 'Size of file: {file_size} ' ) 3895459 Note that content length returns a string and not a number. In [10]: from tqdm import tqdm r = requests . get ( url , stream = True ) initial_pos = 0 with open ( 'government_interest.tsv.zip' , 'wb' ) as f : with tqdm ( total = file_size , unit = 'B' , unit_scale = True , unit_divisor = 1024 , desc = 'government_interest.tsv.zip' , initial = initial_pos , ascii = True , miniters = 1 ) as pbar : for chunk in r . iter_content ( 32 * 1024 ): f . write ( chunk ) pbar . update ( len ( chunk )) government_interest.tsv.zip: 100%|#################################################| 3.71M/3.71M [00:26<00:00, 254kB/s] Complete script At last, here is the complete script. if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) { var mathjaxscript = document.createElement('script'); mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#'; mathjaxscript.type = 'text/javascript'; mathjaxscript.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML'; mathjaxscript[(window.opera ? \"innerHTML\" : \"text\")] = \"MathJax.Hub.Config({\" + \" config: ['MMLorHTML.js'],\" + \" TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },\" + \" jax: ['input/TeX','input/MathML','output/HTML-CSS'],\" + \" extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],\" + \" displayAlign: 'center',\" + \" displayIndent: '0em',\" + \" showMathMenu: true,\" + \" tex2jax: { \" + \" inlineMath: [ ['$','$'] ], \" + \" displayMath: [ ['$$','$$'] ],\" + \" processEscapes: true,\" + \" preview: 'TeX',\" + \" }, \" + \" 'HTML-CSS': { \" + \" linebreaks: { automatic: true, width: '95% container' }, \" + \" styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }\" + \" } \" + \"}); \"; (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript); }","tags":"blog","url":"blog/how-to-download-files-with-python.html"},{"title":"How to compile and distribute an R package with conda","text":"TL;DR: This article shows how to compile and distribute R packages on anaconda.org to be used in your data science projects. Introduction to Anaconda and R I like to manage my research projects with conda which is the package manager for Anaconda , a popular Python distribution for data science. For one of my recent projects I also needed to install R and I was lucky to find out that R is also available with conda . First, you create your normal Python environment for your new project $ conda create --name project python = 3 .6 anaconda This installs a complete Anaconda distribution with Python 3.6 under the name project . If you only want the bare Python interpreter, call $ conda create -n project python = 3 .6 Activate the environment with $ activate project Hint: Since my os is running on Windows, I prefer to use Powershell. Unfortunately, activating and deactivating your environment usually fails. Try out pscondaenvs which installs corrected Powershell scripts. If we also need an R distribution for our project, we have to make the decision between to R from R-Project and MRO from Microsoft. The latter is the default with Anaconda, but the former is still provided if you are running a 32-bit operating system or an older macOS version. The advantage of MRO is that it is using the Intel Math Kernel Library (MKL) and enables multithreading by default ( here are some benchmark reports and information on how to set the number of threads used). Installing a basic R interpreter from MRO is as simle as typing $ conda install --channel r mro-base If you want to install R from R-Project, type conda install -c r r-base . It is important to note that it is impossible to have both R interpreters in one environment and that packages for either one of them do not work with the other. You can find more information here . There is also the option to install a whole R distribution which is called r-essentials . It bundles many useful packages along with IRkernel which enables you to use R in Jupyter notebooks. Again, there are two commands depending on which R interpreter you are using. $ conda install -c r r-essentials $ conda install -c r r-essentials r-base To update all of your R packages run $ conda update r-essentials If your desired package is not available in r-essentials , you can use the search on anaconda.org to find a channel which offers your package. But what if your package is not available? Building and Distributing an R package I had the same issue when I wanted to use mice which is a known framework for multiple imputation by chained equations. To build the package for your conda distribution, invoke the following command $ conda skeleton cran r-mice This will create a folder called r-mice which contains three files, bld.bat , build.sh and meta.yml . meta.yml is the important file which controls the compilation. An example can be found here . Note the key called requirements . inside host and run the R interpreter is defined. By default it is r-base . If you are using MRO, you have to change this to mro-base . requirements : build : - {{ compiler('c') }} # [not win] - {{ compiler('cxx') }} # [not win] - {{ native }} toolchain # [win] - {{ posix }} filesystem # [win] - {{ posix }} make host : - r-base - r-mass - r-rcpp - r-lattice - r-nnet - r-rpart - r-survival run : - r-base - {{ native }} gcc-libs # [win] - r-mass - r-rcpp - r-lattice - r-nnet - r-rpart - r-survival In the next step, we want to compile the package. If you are on Windows, make sure to install RTools in advance and add binaries to your system's path during the installation. To compile the package, type $ conda build r-mice After the compilation ended successfully, you can install the package with $ conda install --use-local r-mice You can also upload the package to Anaconda.org to your private repository and make it accessible to all people. That's what I did. I have created a repository which builds the package for Linux and macOS with Travis-CI and Windows with Appveyor . The compiled packages are uploaded to my account and can be install via $ conda install -c brimborium r-mice Compile your own package If you want to use my solution for yourself, fork my repository. Then, replace the recipe in conda-recipe with your recipe create with $ conda skeleton cran <package name> Push the repository to your Github account and create accounts on Travis- CI , Appveyor and Anaconda.org . Next, go to Anaconda.org, settings, access and create a token. Make sure to check allow read and write API access. The rest is optional. Set the resulting token as a secret environment variable to your projects on Travis-CI and Appveyor. Make sure to name it CONDA_UPLOAD_TOKEN as the scripts look for a variable called like this. I know this was a fair amount of information and if you are not familiar with automation tools like Travis-CI and Appveyor, this looks even more deterrent. But that is why I created my repository which is reduced to the minimal amount of code to do the task. I will also extend this post and the repository description in the future. Since I do only have rudimentary knowledge of the background of what I did, there is a lot of room to grow :). Resources: Anaconda: Download and more Using R language with Anaconda PSCondaEnvs: Fix activate/deactivate on Windows with Powershell mice by Stef van Buuren conda: documentation IRkernel: Use R with Jupyter notebooks RTools: Download","tags":"blog","url":"blog/how-to-compile-and-distribute-an-r-package-with-conda.html"},{"title":"The Tragedy of Titanic","text":"TL;DR: Analysis of survival rates on the Titanic with an interesting placebo test for whether traveling in couples increased the likelihood of survival. /*! * * IPython notebook * */ /* CSS font colors for translated ANSI colors. */ .ansibold { font-weight: bold; } /* use dark versions for foreground, to improve visibility */ .ansiblack { color: black; } .ansired { color: darkred; } .ansigreen { color: darkgreen; } .ansiyellow { color: #c4a000; } .ansiblue { color: darkblue; } .ansipurple { color: darkviolet; } .ansicyan { color: steelblue; } .ansigray { color: gray; } /* and light for background, for the same reason */ .ansibgblack { background-color: black; } .ansibgred { background-color: red; } .ansibggreen { background-color: green; } .ansibgyellow { background-color: yellow; } .ansibgblue { background-color: blue; } .ansibgpurple { background-color: magenta; } .ansibgcyan { background-color: cyan; } .ansibggray { background-color: gray; } div.cell { /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; /* This acts as a spacer between cells, that is outside the border */ margin: 0px; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); } div.cell.jupyter-soft-selected { border-left-color: #90CAF9; border-left-color: #E3F2FD; border-left-width: 1px; padding-left: 5px; border-right-color: #E3F2FD; border-right-width: 1px; background: #E3F2FD; } @media print { div.cell.jupyter-soft-selected { border-color: transparent; } } div.cell.selected { border-color: #ababab; border-left-width: 0px; padding-left: 6px; background: linear-gradient(to right, #42A5F5 -40px, #42A5F5 5px, transparent 5px, transparent 100%); } @media print { div.cell.selected { border-color: transparent; } } div.cell.selected.jupyter-soft-selected { border-left-width: 0; padding-left: 6px; background: linear-gradient(to right, #42A5F5 -40px, #42A5F5 7px, #E3F2FD 7px, #E3F2FD 100%); } .edit_mode div.cell.selected { border-color: #66BB6A; border-left-width: 0px; padding-left: 6px; background: linear-gradient(to right, #66BB6A -40px, #66BB6A 5px, transparent 5px, transparent 100%); } @media print { .edit_mode div.cell.selected { border-color: transparent; } } .prompt { /* This needs to be wide enough for 3 digit prompt numbers: In[100]: */ min-width: 14ex; /* This padding is tuned to match the padding on the CodeMirror editor. */ padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; /* This has to match that of the the CodeMirror class line-height below */ line-height: 1.21429em; /* Don't highlight prompt number selection */ -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; /* Use default cursor */ cursor: default; } @media (max-width: 540px) { .prompt { text-align: left; } } div.inner_cell { min-width: 0; /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; /* Old browsers */ -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; /* Modern browsers */ flex: 1; } /* input_area and input_prompt must match in top border and margin for alignment */ div.input_area { border: 1px solid #cfcfcf; border-radius: 2px; background: #f7f7f7; line-height: 1.21429em; } /* This is needed so that empty prompt areas can collapse to zero height when there is no content in the output_subarea and the prompt. The main purpose of this is to make sure that empty JavaScript output_subareas have no height. */ div.prompt:empty { padding-top: 0; padding-bottom: 0; } div.unrecognized_cell { padding: 5px 5px 5px 0px; /* Old browsers */ display: -webkit-box; -webkit-box-orient: horizontal; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: horizontal; -moz-box-align: stretch; display: box; box-orient: horizontal; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: row; align-items: stretch; } div.unrecognized_cell .inner_cell { border-radius: 2px; padding: 5px; font-weight: bold; color: red; border: 1px solid #cfcfcf; background: #eaeaea; } div.unrecognized_cell .inner_cell a { color: inherit; text-decoration: none; } div.unrecognized_cell .inner_cell a:hover { color: inherit; text-decoration: none; } @media (max-width: 540px) { div.unrecognized_cell > div.prompt { display: none; } } div.code_cell { /* avoid page breaking on code cells when printing */ } @media print { div.code_cell { page-break-inside: avoid; } } /* any special styling for code cells that are currently running goes here */ div.input { page-break-inside: avoid; /* Old browsers */ display: -webkit-box; -webkit-box-orient: horizontal; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: horizontal; -moz-box-align: stretch; display: box; box-orient: horizontal; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: row; align-items: stretch; } @media (max-width: 540px) { div.input { /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; } } /* input_area and input_prompt must match in top border and margin for alignment */ div.input_prompt { color: #303F9F; border-top: 1px solid transparent; } div.input_area > div.highlight { margin: 0.4em; border: none; padding: 0px; background-color: transparent; } div.input_area > div.highlight > pre { margin: 0px; border: none; padding: 0px; background-color: transparent; } /* The following gets added to the <head> if it is detected that the user has a * monospace font with inconsistent normal/bold/italic height. See * notebookmain.js. Such fonts will have keywords vertically offset with * respect to the rest of the text. The user should select a better font. * See: https://github.com/ipython/ipython/issues/1503 * * .CodeMirror span { * vertical-align: bottom; * } */ .CodeMirror { line-height: 1.21429em; /* Changed from 1em to our global default */ font-size: 14px; height: auto; /* Changed to auto to autogrow */ background: none; /* Changed from white to allow our bg to show through */ } .CodeMirror-scroll { /* The CodeMirror docs are a bit fuzzy on if overflow-y should be hidden or visible.*/ /* We have found that if it is visible, vertical scrollbars appear with font size changes.*/ overflow-y: hidden; overflow-x: auto; } .CodeMirror-lines { /* In CM2, this used to be 0.4em, but in CM3 it went to 4px. We need the em value because */ /* we have set a different line-height and want this to scale with that. */ padding: 0.4em; } .CodeMirror-linenumber { padding: 0 8px 0 4px; } .CodeMirror-gutters { border-bottom-left-radius: 2px; border-top-left-radius: 2px; } .CodeMirror pre { /* In CM3 this went to 4px from 0 in CM2. We need the 0 value because of how we size */ /* .CodeMirror-lines */ padding: 0; border: 0; border-radius: 0; } /* Original style from softwaremaniacs.org (c) Ivan Sagalaev <Maniac@SoftwareManiacs.Org> Adapted from GitHub theme */ .highlight-base { color: #000; } .highlight-variable { color: #000; } .highlight-variable-2 { color: #1a1a1a; } .highlight-variable-3 { color: #333333; } .highlight-string { color: #BA2121; } .highlight-comment { color: #408080; font-style: italic; } .highlight-number { color: #080; } .highlight-atom { color: #88F; } .highlight-keyword { color: #008000; font-weight: bold; } .highlight-builtin { color: #008000; } .highlight-error { color: #f00; } .highlight-operator { color: #AA22FF; font-weight: bold; } .highlight-meta { color: #AA22FF; } /* previously not defined, copying from default codemirror */ .highlight-def { color: #00f; } .highlight-string-2 { color: #f50; } .highlight-qualifier { color: #555; } .highlight-bracket { color: #997; } .highlight-tag { color: #170; } .highlight-attribute { color: #00c; } .highlight-header { color: blue; } .highlight-quote { color: #090; } .highlight-link { color: #00c; } /* apply the same style to codemirror */ .cm-s-ipython span.cm-keyword { color: #008000; font-weight: bold; } .cm-s-ipython span.cm-atom { color: #88F; } .cm-s-ipython span.cm-number { color: #080; } .cm-s-ipython span.cm-def { color: #00f; } .cm-s-ipython span.cm-variable { color: #000; } .cm-s-ipython span.cm-operator { color: #AA22FF; font-weight: bold; } .cm-s-ipython span.cm-variable-2 { color: #1a1a1a; } .cm-s-ipython span.cm-variable-3 { color: #333333; } .cm-s-ipython span.cm-comment { color: #408080; font-style: italic; } .cm-s-ipython span.cm-string { color: #BA2121; } .cm-s-ipython span.cm-string-2 { color: #f50; } .cm-s-ipython span.cm-meta { color: #AA22FF; } .cm-s-ipython span.cm-qualifier { color: #555; } .cm-s-ipython span.cm-builtin { color: #008000; } .cm-s-ipython span.cm-bracket { color: #997; } .cm-s-ipython span.cm-tag { color: #170; } .cm-s-ipython span.cm-attribute { color: #00c; } .cm-s-ipython span.cm-header { color: blue; } .cm-s-ipython span.cm-quote { color: #090; } .cm-s-ipython span.cm-link { color: #00c; } .cm-s-ipython span.cm-error { color: #f00; } .cm-s-ipython span.cm-tab { background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAAXNSR0IArs4c6QAAAGFJREFUSMft1LsRQFAQheHPowAKoACx3IgEKtaEHujDjORSgWTH/ZOdnZOcM/sgk/kFFWY0qV8foQwS4MKBCS3qR6ixBJvElOobYAtivseIE120FaowJPN75GMu8j/LfMwNjh4HUpwg4LUAAAAASUVORK5CYII=); background-position: right; background-repeat: no-repeat; } div.output_wrapper { /* this position must be relative to enable descendents to be absolute within it */ position: relative; /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; z-index: 1; } /* class for the output area when it should be height-limited */ div.output_scroll { /* ideally, this would be max-height, but FF barfs all over that */ height: 24em; /* FF needs this *and the wrapper* to specify full width, or it will shrinkwrap */ width: 100%; overflow: auto; border-radius: 2px; -webkit-box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8); box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8); display: block; } /* output div while it is collapsed */ div.output_collapsed { margin: 0px; padding: 0px; /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; } div.out_prompt_overlay { height: 100%; padding: 0px 0.4em; position: absolute; border-radius: 2px; } div.out_prompt_overlay:hover { /* use inner shadow to get border that is computed the same on WebKit/FF */ -webkit-box-shadow: inset 0 0 1px #000; box-shadow: inset 0 0 1px #000; background: rgba(240, 240, 240, 0.5); } div.output_prompt { color: #D84315; } /* This class is the outer container of all output sections. */ div.output_area { padding: 0px; page-break-inside: avoid; /* Old browsers */ display: -webkit-box; -webkit-box-orient: horizontal; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: horizontal; -moz-box-align: stretch; display: box; box-orient: horizontal; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: row; align-items: stretch; } div.output_area .MathJax_Display { text-align: left !important; } div.output_area div.output_area div.output_area img, div.output_area svg { max-width: 100%; height: auto; } div.output_area img.unconfined, div.output_area svg.unconfined { max-width: none; } /* This is needed to protect the pre formating from global settings such as that of bootstrap */ .output { /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; } @media (max-width: 540px) { div.output_area { /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; } } div.output_area pre { margin: 0; padding: 0; border: 0; vertical-align: baseline; color: black; background-color: transparent; border-radius: 0; } /* This class is for the output subarea inside the output_area and after the prompt div. */ div.output_subarea { overflow-x: auto; padding: 0.4em; /* Old browsers */ -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; /* Modern browsers */ flex: 1; max-width: calc(100% - 14ex); } div.output_scroll div.output_subarea { overflow-x: visible; } /* The rest of the output_* classes are for special styling of the different output types */ /* all text output has this class: */ div.output_text { text-align: left; color: #000; /* This has to match that of the the CodeMirror class line-height below */ line-height: 1.21429em; } /* stdout/stderr are 'text' as well as 'stream', but execute_result/error are *not* streams */ div.output_stderr { background: #fdd; /* very light red background for stderr */ } div.output_latex { text-align: left; } /* Empty output_javascript divs should have no height */ div.output_javascript:empty { padding: 0; } .js-error { color: darkred; } /* raw_input styles */ div.raw_input_container { line-height: 1.21429em; padding-top: 5px; } pre.raw_input_prompt { /* nothing needed here. */ } input.raw_input { font-family: monospace; font-size: inherit; color: inherit; width: auto; /* make sure input baseline aligns with prompt */ vertical-align: baseline; /* padding + margin = 0.5em between prompt and cursor */ padding: 0em 0.25em; margin: 0em 0.25em; } input.raw_input:focus { box-shadow: none; } p.p-space { margin-bottom: 10px; } div.output_unrecognized { padding: 5px; font-weight: bold; color: red; } div.output_unrecognized a { color: inherit; text-decoration: none; } div.output_unrecognized a:hover { color: inherit; text-decoration: none; } .rendered_html { color: #000; /* any extras will just be numbers: */ } .rendered_html :link { text-decoration: underline; } .rendered_html :visited { text-decoration: underline; } .rendered_html h1:first-child { margin-top: 0.538em; } .rendered_html h2:first-child { margin-top: 0.636em; } .rendered_html h3:first-child { margin-top: 0.777em; } .rendered_html h4:first-child { margin-top: 1em; } .rendered_html h5:first-child { margin-top: 1em; } .rendered_html h6:first-child { margin-top: 1em; } .rendered_html * + ul { margin-top: 1em; } .rendered_html * + ol { margin-top: 1em; } .rendered_html pre, .rendered_html tr, .rendered_html th, .rendered_html td, .rendered_html * + table { margin-top: 1em; } .rendered_html * + p { margin-top: 1em; } .rendered_html * + img { margin-top: 1em; } .rendered_html img, .rendered_html img.unconfined, div.text_cell { /* Old browsers */ display: -webkit-box; -webkit-box-orient: horizontal; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: horizontal; -moz-box-align: stretch; display: box; box-orient: horizontal; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: row; align-items: stretch; } @media (max-width: 540px) { div.text_cell > div.prompt { display: none; } } div.text_cell_render { /*font-family: \"Helvetica Neue\", Arial, Helvetica, Geneva, sans-serif;*/ outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; } a.anchor-link:link { text-decoration: none; padding: 0px 20px; visibility: hidden; } h1:hover .anchor-link, h2:hover .anchor-link, h3:hover .anchor-link, h4:hover .anchor-link, h5:hover .anchor-link, h6:hover .anchor-link { visibility: visible; } .text_cell.rendered .input_area { display: none; } .text_cell.rendered .text_cell.unrendered .text_cell_render { display: none; } .cm-header-1, .cm-header-2, .cm-header-3, .cm-header-4, .cm-header-5, .cm-header-6 { font-weight: bold; font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif; } .cm-header-1 { font-size: 185.7%; } .cm-header-2 { font-size: 157.1%; } .cm-header-3 { font-size: 128.6%; } .cm-header-4 { font-size: 110%; } .cm-header-5 { font-size: 100%; font-style: italic; } .cm-header-6 { font-size: 100%; font-style: italic; } .highlight .hll { background-color: #ffffcc } .highlight { background: #f8f8f8; } .highlight .c { color: #408080; font-style: italic } /* Comment */ .highlight .err { border: 1px solid #FF0000 } /* Error */ .highlight .k { color: #008000; font-weight: bold } /* Keyword */ .highlight .o { color: #666666 } /* Operator */ .highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */ .highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */ .highlight .cp { color: #BC7A00 } /* Comment.Preproc */ .highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */ .highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */ .highlight .cs { color: #408080; font-style: italic } /* Comment.Special */ .highlight .gd { color: #A00000 } /* Generic.Deleted */ .highlight .ge { font-style: italic } /* Generic.Emph */ .highlight .gr { color: #FF0000 } /* Generic.Error */ .highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */ .highlight .gi { color: #00A000 } /* Generic.Inserted */ .highlight .go { color: #888888 } /* Generic.Output */ .highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */ .highlight .gs { font-weight: bold } /* Generic.Strong */ .highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */ .highlight .gt { color: #0044DD } /* Generic.Traceback */ .highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */ .highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */ .highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */ .highlight .kp { color: #008000 } /* Keyword.Pseudo */ .highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */ .highlight .kt { color: #B00040 } /* Keyword.Type */ .highlight .m { color: #666666 } /* Literal.Number */ .highlight .s { color: #BA2121 } /* Literal.String */ .highlight .na { color: #7D9029 } /* Name.Attribute */ .highlight .nb { color: #008000 } /* Name.Builtin */ .highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */ .highlight .no { color: #880000 } /* Name.Constant */ .highlight .nd { color: #AA22FF } /* Name.Decorator */ .highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */ .highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */ .highlight .nf { color: #0000FF } /* Name.Function */ .highlight .nl { color: #A0A000 } /* Name.Label */ .highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */ .highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */ .highlight .nv { color: #19177C } /* Name.Variable */ .highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */ .highlight .w { color: #bbbbbb } /* Text.Whitespace */ .highlight .mb { color: #666666 } /* Literal.Number.Bin */ .highlight .mf { color: #666666 } /* Literal.Number.Float */ .highlight .mh { color: #666666 } /* Literal.Number.Hex */ .highlight .mi { color: #666666 } /* Literal.Number.Integer */ .highlight .mo { color: #666666 } /* Literal.Number.Oct */ .highlight .sa { color: #BA2121 } /* Literal.String.Affix */ .highlight .sb { color: #BA2121 } /* Literal.String.Backtick */ .highlight .sc { color: #BA2121 } /* Literal.String.Char */ .highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */ .highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */ .highlight .s2 { color: #BA2121 } /* Literal.String.Double */ .highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */ .highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */ .highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */ .highlight .sx { color: #008000 } /* Literal.String.Other */ .highlight .sr { color: #BB6688 } /* Literal.String.Regex */ .highlight .s1 { color: #BA2121 } /* Literal.String.Single */ .highlight .ss { color: #19177C } /* Literal.String.Symbol */ .highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */ .highlight .fm { color: #0000FF } /* Name.Function.Magic */ .highlight .vc { color: #19177C } /* Name.Variable.Class */ .highlight .vg { color: #19177C } /* Name.Variable.Global */ .highlight .vi { color: #19177C } /* Name.Variable.Instance */ .highlight .vm { color: #19177C } /* Name.Variable.Magic */ .highlight .il { color: #666666 } /* Literal.Number.Integer.Long */ /* Temporary definitions which will become obsolete with Notebook release 5.0 */ .ansi-black-fg { color: #3E424D; } .ansi-black-bg { background-color: #3E424D; } .ansi-black-intense-fg { color: #282C36; } .ansi-black-intense-bg { background-color: #282C36; } .ansi-red-fg { color: #E75C58; } .ansi-red-bg { background-color: #E75C58; } .ansi-red-intense-fg { color: #B22B31; } .ansi-red-intense-bg { background-color: #B22B31; } .ansi-green-fg { color: #00A250; } .ansi-green-bg { background-color: #00A250; } .ansi-green-intense-fg { color: #007427; } .ansi-green-intense-bg { background-color: #007427; } .ansi-yellow-fg { color: #DDB62B; } .ansi-yellow-bg { background-color: #DDB62B; } .ansi-yellow-intense-fg { color: #B27D12; } .ansi-yellow-intense-bg { background-color: #B27D12; } .ansi-blue-fg { color: #208FFB; } .ansi-blue-bg { background-color: #208FFB; } .ansi-blue-intense-fg { color: #0065CA; } .ansi-blue-intense-bg { background-color: #0065CA; } .ansi-magenta-fg { color: #D160C4; } .ansi-magenta-bg { background-color: #D160C4; } .ansi-magenta-intense-fg { color: #A03196; } .ansi-magenta-intense-bg { background-color: #A03196; } .ansi-cyan-fg { color: #60C6C8; } .ansi-cyan-bg { background-color: #60C6C8; } .ansi-cyan-intense-fg { color: #258F8F; } .ansi-cyan-intense-bg { background-color: #258F8F; } .ansi-white-fg { color: #C5C1B4; } .ansi-white-bg { background-color: #C5C1B4; } .ansi-white-intense-fg { color: #A1A6B2; } .ansi-white-intense-bg { background-color: #A1A6B2; } .ansi-bold { font-weight: bold; } Introduction This Jupyter notebook uses the Titanic dataset from Kaggle for the prediction of survival rates among passengers on the Titanic. RMS Titanic was a British passenger liner that sank in the North Atlantic Ocean in the early morning of 15 April 1912, after colliding with an iceberg during her maiden voyage from Southampton to New York City. Of the 2,224 passengers and crew aboard, more than 1,500 died in the sinking, making it one of the deadliest commercial peacetime maritime disasters in modern history. The largest ship afloat at the time it entered service, the RMS Titanic was the second of three Olympic class ocean liners operated by the White Star Line, and was built by the Harland and Wolff shipyard in Belfast. Thomas Andrews, her architect, died in the disaster. The main goals of this analysis are a descriptive analysis of the data, a sophisticated feature engineering approach, and a comparison of established prediction models. In addition to that, the whole analysis should be presented in the best possible way, so that the notebook serves as a best practice example. In [1]: % matplotlib inline import warnings warnings . filterwarnings ( 'ignore' , category = FutureWarning ) import matplotlib.patches as mpatches import matplotlib.pyplot as plt import numpy as np import os import pandas as pd import seaborn as sns from time import time from pathlib import Path from scipy.stats import randint as sp_randint from sklearn.ensemble import RandomForestClassifier from sklearn.ensemble import RandomForestRegressor from sklearn.model_selection import cross_val_score from sklearn.model_selection import RandomizedSearchCV sns . set_style ( 'whitegrid' ) np . random . seed ( 123 ) C:\\Users\\tobia\\AppData\\Local\\conda\\conda\\envs\\titanic\\lib\\site-packages\\sklearn\\ensemble\\weight_boosting.py:29: DeprecationWarning: numpy.core.umath_tests is an internal NumPy module and should not be imported. It will be removed in a future NumPy release. from numpy.core.umath_tests import inner1d In [2]: train = pd . read_csv ( Path ( 'data' , 'train.csv' )) test = pd . read_csv ( Path ( 'data' , 'test.csv' )) train . Embarked = train . Embarked . map ({ 'S' : 'Southampton' , 'C' : 'Cherbourg' , 'Q' : 'Queenstown' }) train . Sex = train . Sex . map ({ 'female' : 'Female' , 'male' : 'Male' }) test . Embarked = test . Embarked . map ({ 'S' : 'Southampton' , 'C' : 'Cherbourg' , 'Q' : 'Queenstown' }) test . Sex = test . Sex . map ({ 'female' : 'Female' , 'male' : 'Male' }) Descriptive Analysis For exploration the whole dataset is used. It consists of 1309 observations and 12 variables. The variables are: Variable Description dtype non-missing train non-missing test Age Age of passenger float64 714 332 Cabin Cabin of passenger object 204 91 Embarked Capital letter indicating the port of embarkation object 889 417 Fare Price of ticket float64 891 418 Name Name of passenger object 891 418 Parch Number of parents & children aboard int64 891 418 PassengerId ID of passenger int64 891 418 Pclass Class of passenger int64 891 418 Sex Sex of passenger object 891 418 SibSp Number of siblings & spouses aboard int64 891 418 Survived Survived (1) or deceased (0) int64 891 418 Ticket Ticket number object 891 418 PassengerId, Ticket, Cabin These variables are not important for the analysis. Passenger Class In [3]: fig , ( axis1 , axis2 ) = plt . subplots ( 1 , 2 , figsize = ( 18 , 6 )) sns . countplot ( x = 'Pclass' , data = train , ax = axis1 ) sns . barplot ( x = 'Pclass' , y = 'Survived' , data = train , ax = axis2 , ci = None ) plt . show () Sex In [4]: fig , ( axis1 , axis2 ) = plt . subplots ( 1 , 2 , figsize = ( 18 , 6 )) sns . countplot ( x = 'Sex' , data = train , ax = axis1 ) sns . barplot ( x = 'Sex' , y = 'Survived' , data = train , ax = axis2 , ci = None ) plt . show () Age In [5]: # Create a dummy for missing age values for later computation train [ 'missing_age' ] = train . Age . isnull () test [ 'missing_age' ] = test . Age . isnull () # Missing computation (could be more sophisticated, since it is only # uniformly distributed) train_age_mean = train . Age . mean () train_age_std = train . Age . std () train_age_nan_count = train . Age . isnull () . sum () test_age_mean = test . Age . mean () test_age_std = test . Age . std () test_age_nan_count = test . Age . isnull () . sum () train_age_rand = np . random . randint ( train_age_mean - train_age_std , train_age_mean + train_age_std , size = train_age_nan_count ) test_age_rand = np . random . randint ( test_age_mean - test_age_std , test_age_mean + test_age_std , size = test_age_nan_count ) # Original distribution orig_train_age_int = train . Age . dropna () . astype ( int ) orig_test_age_int = test . Age . dropna () . astype ( int ) # Computed age distribution train . loc [ train . Age . isnull (), 'Age' ] = train_age_rand comp_train_age_int = train . Age . astype ( int ) test . loc [ test . Age . isnull (), 'Age' ] = test_age_rand comp_test_age_int = test . Age . astype ( int ) fig , ( axis1 , axis2 ) = plt . subplots ( 2 , 1 , figsize = ( 18 , 8 )) axis1 . set_title ( 'Original Age Distribution' ) sns . distplot ( orig_train_age_int , ax = axis1 , kde = False , bins = np . arange ( 0 , 80.5 , 1 )) axis2 . set_title ( 'Computed Age Distribution' ) sns . distplot ( comp_train_age_int , ax = axis2 , kde = False , bins = np . arange ( 0 , 80.5 , 1 )) plt . tight_layout () plt . show () # Convert Age from float to int, because of simplicity train . Age = train . Age . astype ( int ) test . Age = test . Age . astype ( int ) In [6]: fig , ax = plt . subplots ( figsize = ( 18 , 6 )) sns . barplot ( 'Age' , 'Survived' , data = train , ax = ax , ci = False ) plt . show () Fare In [7]: # Could be better, think about a more appropriate solution fig , ( ax1 , ax2 ) = plt . subplots ( 1 , 2 , figsize = ( 18 , 6 )) sns . distplot ( train . Fare , kde = False , ax = ax1 ) sns . distplot ( train [ train . Survived == 1 ][ 'Fare' ], kde = True , ax = ax2 ) sns . distplot ( train [ train . Survived == 0 ][ 'Fare' ], kde = True , ax = ax2 ) ax2 . legend ([ 'Survived' , 'Deceased' ]) plt . show () Missing Computation and Feature Engineering Fare We forgot to fix one missing value in fare in the test dataset. We will replace it by the median fare value for the specific passenger class. In [8]: test . Fare = test . Fare . fillna ( test . loc [ test . Pclass == 3 , 'Fare' ] . median ()) Cabin Previously discarded, we will take a look at the cabin variable. The variable consists of a letter indicating the deck and a room number. The number is less important, but an indicator variable for the deck could reveal further information despite the fact that the cabin number is missing in 75% of the data. For further information look at Wikipedia . It seems impossible to predict deck membership. In [9]: train [ 'Deck' ] = train . Cabin . astype ( str ) . str . extract ( \"(?P<letter>[A-Z])\" , expand = False ) train . loc [ train . Deck . isnull (), 'Deck' ] = 'Missing' test [ 'Deck' ] = test . Cabin . astype ( str ) . str . extract ( \"(?P<letter>[A-Z])\" , expand = False ) test . loc [ test . Deck . isnull (), 'Deck' ] = 'Missing' In [10]: fig , ( ax1 , ax2 ) = plt . subplots ( 1 , 2 , figsize = ( 18 , 6 )) sns . countplot ( 'Deck' , data = train , ax = ax1 , order = [ 'C' , 'D' , 'E' , 'F' , 'G' , 'F' , 'T' ]) sns . barplot ( x = 'Deck' , y = 'Survived' , data = train , ax = ax2 , order = [ 'A' , 'B' , 'C' , 'D' , 'E' , 'F' , 'G' , 'T' , 'Missing' ], ci = False ) plt . show () In [11]: fig , ax = plt . subplots ( figsize = ( 18 , 6 )) sns . boxplot ( x = 'Deck' , y = 'Fare' , hue = 'Pclass' , data = train , ax = ax , order = [ 'A' , 'B' , 'C' , 'D' , 'E' , 'F' , 'G' , 'T' , 'Missing' ]) plt . show () Embarked There are two missing values in the training dataset. Let us have a look at the port of embarkation and the fare. The dotted horizontal line in the second graph shows the fare value of observations with missing port values. The fare values seem to overlap with Cherbourg. In [12]: fig , ( ax1 , ax2 ) = plt . subplots ( 1 , 2 , figsize = ( 18 , 6 )) sns . countplot ( 'Embarked' , data = train , ax = ax1 ) # limit yaxis, because of outlier sns . boxplot ( x = 'Embarked' , y = 'Fare' , data = train , ax = ax2 ) ax2 . set_ylim ([ 0 , 300 ]) ax2 . axhline ( 80 , c = 'black' , linestyle = '--' ) plt . show () The boxplot does not show very clear whether the two passengers embarked in Southampton or Cherbourg. A fare of 80 seems to be on the edge of the box and therefore on the upper quartile. What you can also see is a concentration of passengers embarked in Southampton between a fare of 70 and 90. In [13]: fig , ( ax1 , ax2 , ax3 ) = plt . subplots ( 1 , 3 , figsize = ( 18 , 6 )) sns . distplot ( train [ train . Embarked == 'Southampton' ][ 'Fare' ], ax = ax1 , kde = True , hist = False ) sns . distplot ( train [ train . Embarked == 'Cherbourg' ][ 'Fare' ], ax = ax1 , kde = True , hist = False ) ax1 . set_xlim ([ 70 , 90 ]) ax1 . set_title ( 'Density of Fare by Embarked' ) sns . distplot ( train [ train . Embarked == 'Southampton' ][ 'Fare' ], ax = ax2 , kde = False , bins = np . arange ( 70 , 91 , 5 )) sns . distplot ( train [ train . Embarked == 'Cherbourg' ][ 'Fare' ], ax = ax2 , kde = False , bins = np . arange ( 70 , 91 , 5 )) ax2 . set_xlim ([ 70 , 90 ]) ax2 . set_title ( 'Absolute frequency of Fare values by Embarked with steps of five' ) sns . distplot ( train [ train . Embarked == 'Southampton' ][ 'Fare' ], ax = ax3 , kde = False , bins = np . arange ( 70 , 91 , 10 )) sns . distplot ( train [ train . Embarked == 'Cherbourg' ][ 'Fare' ], ax = ax3 , kde = False , bins = np . arange ( 70 , 91 , 10 )) ax3 . set_xlim ([ 70 , 90 ]) ax3 . set_title ( 'Absolute frequency of Fare values by Embarked with steps of ten' ) south_patch = mpatches . Patch ( color = sns . color_palette ()[ 0 ], label = 'Southampton' ) cher_patch = mpatches . Patch ( color = sns . color_palette ()[ 1 ], label = 'Cherbourg' ) plt . legend ( handles = [ south_patch , cher_patch ], prop = { 'size' : 12 }) plt . show () As you can see in graphic one, the density of for Cherbourg is slightly higher than for Southampton. But this is only in relation to all passengers from this port. Since passengers are not equally distributed among ports, we have to look at the absolute distribution. The histograms in graphic two and three show that the thresholds for similar observations is the critical assumption. Consider that passengers with fares from 75 to 85 are the correct comparison, you will favor Cherbourg over Southampton. But, you would have the opposite view if you choose fare values between 70 and 90. Since normal data analysis seems to be ambiguous, I guide you to Encyclopedia Titanica , a site which offers more information about the passengers and their destiny, deckplans and a lot more. The passenger list also includes biographies of passenger and among them the two. Mrs. Stone embarked with her maid Miss. Icard in Southampton (Link) . In [14]: # Set the embarked value of the couple to Southampton train . loc [ train . Embarked . isnull (), 'Embarked' ] = 'Southampton' Construct Title and Surname Here we are going to construct a variable which includes the title and the surname of passengers. The title should also reveal insights into the socio-economic status of passengers if doctors or aristocrats are among these. This is probably already covered by face and passenger class, but nevermind. The second variable is especially important to find families among the passengers and see whether they have higher survival probabilities because of mutual assistance. The titles are surprisingly not wildly different. There are only 18 different titles. There are Spanish and English aristocrates and also a Belgian or Dutch Jonkheer which is a title for a young aristocrat without a royal or noble rank. Some of titles are the same in different translations. In the dictionary below you can find the mapping to English expressions. In a sample of 1309 observations there are 875 distinct surnames. In [15]: train [ 'Title' ] = train . Name . str . split ( ',' , expand = True )[ 1 ] . str . split ( expand = True ) . get ( 0 ) . str . strip ( '.' ) train . loc [( train . Title == 'the' ), 'Title' ] = 'Countess' test [ 'Title' ] = test . Name . str . split ( ',' , expand = True )[ 1 ] . str . split ( expand = True ) . get ( 0 ) . str . strip ( '.' ) test . loc [( test . Title == 'the' ), 'Title' ] = 'Countess' social_rank = { 'Capt' : 'Military' , 'Col' : 'Military' , 'Major' : 'Military' , 'Countess' : 'Nobility' , 'Jonkheer' : 'Nobility' , 'Sir' : 'Nobility' , 'Lady' : 'Middle_Class' , 'Don' : 'Middle_Class' , 'Dr' : 'Middle_Class' , 'Master' : 'Middle_Class' , 'Mlle' : 'Unmarried_Woman' , 'Ms' : 'Unmarried_Woman' , 'Miss' : 'Unmarried_Woman' , 'Dona' : 'Unmarried_Woman' , 'Mme' : 'Married_Woman' , 'Mrs' : 'Married_Woman' , } train . Title = train . Title . replace ( social_rank ) test . Title = test . Title . replace ( social_rank ) train [ 'Surname' ] = train . Name . str . split ( ',' , expand = True ) . get ( 0 ) test [ 'Surname' ] = test . Name . str . split ( ',' , expand = True ) . get ( 0 ) Age Yes, again age. Before, we made very simple calculation to fill empty spaces. Now, we will try to compute age values by using a random forest regression. In [16]: # Prepare data for training age_train = train . loc [ train . missing_age == False ] . copy () age_train [ 'Pclass' ] = age_train [ 'Pclass' ] . astype ( str ) age_test = train . loc [ train . missing_age == True ] . copy () age_test [ 'Pclass' ] = age_test [ 'Pclass' ] . astype ( str ) features = [ 'Sex' , 'Fare' , 'Embarked' , 'Pclass' , 'Parch' , 'SibSp' ] age_x = pd . get_dummies ( age_train [ features ]) age_x_test = pd . get_dummies ( age_test [ features ]) age_y = age_train [ 'Age' ] # Prepare data for test set test_x = test . loc [ test . missing_age == True , features ] test_x [ 'Pclass' ] = test_x [ 'Pclass' ] . astype ( str ) test_x = pd . get_dummies ( test_x ) Let us have a look at feature importance. Note that, in a previous version I also used Survived as a feature and it is the fith most important feature. But, obviously it is not included in the test set, so I will drop it for now and maybe revisit Age after we predicted the survival rates of passengers in the test set. In [17]: # Evaluate feature importance clf = RandomForestRegressor ( n_estimators = 1000 , n_jobs =- 1 ) feat_imp = clf . fit ( age_x , age_y ) . feature_importances_ age_feat_imp = pd . DataFrame ( { 'Variables' : age_x . keys () . values , 'Feature Importance' : feat_imp } ) . sort_values ( 'Feature Importance' , ascending = False ) fig , ( axis1 ) = plt . subplots ( 1 , 1 , figsize = ( 18 , 6 )) sns . barplot ( y = 'Variables' , x = 'Feature Importance' , data = age_feat_imp , ax = axis1 , orient = 'h' ) axis1 . set_title ( 'Feature Importance' ) axis1 . set_xlabel ( '' ) plt . show () This is a small plot to show the convergence speed of the RandomForestRegressor by the number of trees. It seems that basically 20 trees are sufficient. But since it is not computationally expensive, we will stick with 1000 trees to be on the safe side. In [18]: # Plot error convergence by number of estimators trees = [] score = [] for i in [ 5 , 10 , 20 , 50 , 100 , 1000 ]: clf = RandomForestRegressor ( n_estimators = i , n_jobs =- 1 , max_features = 0.5 ) scores = cross_val_score ( clf , age_x , age_y , cv = 5 , scoring = 'neg_mean_squared_error' ) trees . append ( i ) score . append ( - scores . mean ()) fig , ax = plt . subplots ( 1 , 1 , figsize = ( 18 , 6 )) sns . barplot ( x = trees , y = score , ax = ax , color = 'C0' ) ax . set_yticks ( np . arange ( 0 , 201 , 20 )) ax . set_title ( 'Convergence Speed' ) ax . set_xlabel ( 'Number of Trees in Forest' ) ax . set_ylabel ( 'Mean Squared Error' ) plt . show () In [19]: # Predict the missing age values clf = RandomForestRegressor ( n_estimators = 1000 , n_jobs =- 1 , max_features = 0.5 ) clf = clf . fit ( age_x , age_y ) train . loc [ train . missing_age == True , 'Age' ] = clf . predict ( age_x_test ) test . loc [ test . missing_age == True , 'Age' ] = clf . predict ( test_x ) Let us look at the new distributions. The first comparison is to evaluate whether the overall distribution of age has significantly changed. In [20]: comp_train_age_int = train . Age . astype ( int ) fig , ax = plt . subplots ( figsize = ( 18 , 6 )) axis1 . set_title ( 'Original vs. Original + Computed Age Distribution' ) sns . distplot ( orig_train_age_int , ax = ax , kde = True , bins = np . arange ( 0 , 80.5 , 1 )) sns . distplot ( comp_train_age_int , ax = ax , kde = True , bins = np . arange ( 0 , 80.5 , 1 )) ax . legend ([ 'Original' , 'Original + Computed' ]) plt . tight_layout () plt . show () In the second comparison we can see the computed distribution tends to be more centered around 30. Of course, we cannot say whether this is false, since the groups could potentially differ. But more observations around the mean of the distribution will not make the data corrupt and the behaviour towards the tails is similar. In [21]: fig , ax = plt . subplots ( figsize = ( 18 , 6 )) sns . distplot ( train . loc [ train . missing_age == False , 'Age' ], bins = np . arange ( 0 , 80.5 , 1 ), ax = ax ) sns . distplot ( train . loc [ train . missing_age == True , 'Age' ], bins = np . arange ( 0 , 80.5 , 1 ), ax = ax ) ax . set_title ( 'Original vs. Computed Age Distribution' ) ax . legend ([ 'Only Original' , 'Only Computed' ]) plt . show () Women and Children First! In the next analysis we focus on a special code of conduct which states that women and children must be saved first in case of an emergency on the high sea. Here is an excerpt from Wikipedia: While the phrase first appeared in the 1860 novel Harrington: A Story of True Love, by William Douglas O'Connor, the first documented application of \"women and children first\" occurred during the 1852 evacuation of the Royal Navy troopship HMS Birkenhead. It is, however, most famously associated with the sinking of RMS Titanic in 1912. As a code of conduct, \"women and children first\" has no basis in maritime law. According to disaster evacuation expert Ed Galea, in modern-day evacuations people will usually \"help the most vulnerable to leave the scene first. It's not necessarily women, but is likely to be the injured, elderly and young children.\" Furthermore, the results of a 2012 Uppsala University study said that the application of \"women and children first\" did not necessarily produce a survival advantage for women and children in practice. At first, we have to find a definition for minors around that time. Since the captain and most of the crew were from English origin ( Wikipedia ), we will follow the English definition of children. At the beginning of the new century childhood as nowadays did not exist, since children were treated as little adults. Instead of spending most of their time in school or playing with friends, children were allowed to work full time from the age of 12 and were minors until 14 ( 20thcenturylondon ). For that reason, we will choose 14 as our cutoff. In [22]: train [ 'Minor' ] = train . Age <= 14 train . Minor = train . Minor . replace ({ 0 : 'Minor' , 1 : 'Adult' }) In [23]: fig , ( ax1 , ax2 ) = plt . subplots ( 1 , 2 , figsize = ( 18 , 6 )) sns . countplot ( 'Minor' , data = train , ax = ax1 ) sns . barplot ( x = 'Minor' , y = 'Survived' , data = train , ax = ax2 , ci = False ) plt . show () In [24]: fig , ( ax1 , ax2 ) = plt . subplots ( 1 , 2 , figsize = ( 18 , 6 )) sns . countplot ( 'Sex' , data = train , ax = ax1 , order = [ 'Female' , 'Male' ]) sns . barplot ( x = 'Sex' , y = 'Survived' , data = train , ax = ax2 , ci = False ) plt . show () In [25]: fig , ( ax1 , ax2 ) = plt . subplots ( 1 , 2 , figsize = ( 18 , 6 )) sns . countplot ( 'Minor' , hue = 'Sex' , data = train , ax = ax1 , hue_order = [ 'Female' , 'Male' ]) sns . barplot ( x = 'Minor' , y = 'Survived' , hue = 'Sex' , data = train , ax = ax2 , hue_order = [ 'Female' , 'Male' ], ci = False ) plt . show () A shared destiny? Families on board of the Titanic After we extracted a surname, we can look for further details about families. First, we are creating a variable for the size of the family and we will look at a simple comparison of survival rates for passengers in company and on their own. After that, we take a more detailed look at different family sizes. Note, the third graph which shows the frequencies of family sizes counts each observation independently and does not represent the actual number of families given a certain size. In [26]: train [ 'Familysize' ] = train [[ 'Parch' , 'SibSp' ]] . sum ( axis = 1 ) + 1 test [ 'Familysize' ] = test [[ 'Parch' , 'SibSp' ]] . sum ( axis = 1 ) + 1 train [ 'Company' ] = ( train . Familysize > 1 ) . replace ({ 1 : 'Company' , 0 : 'Alone' }) test [ 'Company' ] = ( test . Familysize > 1 ) . replace ({ 1 : 'Company' , 0 : 'Alone' }) In [27]: fig , ( axis1 , axis2 ) = plt . subplots ( 1 , 2 , figsize = ( 18 , 6 )) sns . countplot ( 'Company' , data = train , ax = axis1 ) sns . barplot ( x = 'Company' , y = 'Survived' , data = train , ax = axis2 , ci = False ) plt . show () In [28]: fig , ( ax1 , ax2 ) = plt . subplots ( 1 , 2 , figsize = ( 18 , 6 )) sns . countplot ( 'Familysize' , data = train , ax = ax1 ) sns . barplot ( x = 'Familysize' , y = 'Survived' , data = train , ax = ax2 , ci = False ) plt . show () Up to this point, we have seen that survival rates are favorable for passenger in company. This effect could be due to two reasons: first, families helped each other during the tragedy or, second, kids drive up survival rates for families. There are two possible solutions: Compare passengers without company only to families with two without minors. Caveat: loners could be different in many aspects to couples. Make a placebo test for couples! If passengers with family size equal to two are radomly matched, characteristics are hold constant, but their bond is not. The construction of families could be done in two ways. The first approach establishes family groups by surname and size of family. But then, there are ca. 20% families with only one member due to different values of family size. This could be due to divorce, different ways of counting, etc.. Another way would be to group the data by surname and fare, since families buy the same ticket. A quick look in the data reveals, that children probably did not get a discount (e.g. the Carter Family) and families did not split among different passenger classes. The second solution is chosen but it is not flawless. Look, for example, at the example given below. Since variables like SibSp can differ for partners, family sizes are also different. In [29]: train . groupby ([ 'Surname' , 'Fare' ]) . get_group (( 'Frauenthal' , 133.6500 )) Out[29]: .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } PassengerId Survived Pclass Name Sex Age SibSp Parch Ticket Fare Cabin Embarked missing_age Deck Title Surname Minor Familysize Company 334 335 1 1 Frauenthal, Mrs. Henry William (Clara Heinshei... Female 35.226733 1 0 PC 17611 133.65 NaN Southampton True Missing Married_Woman Frauenthal Minor 2 Company 660 661 1 1 Frauenthal, Dr. Henry William Male 50.000000 2 0 PC 17611 133.65 NaN Southampton False Missing Middle_Class Frauenthal Minor 3 Company In [30]: # Construct families by grouping surname and fare i = 1 for sur , fare in train . groupby ([ 'Surname' , 'Fare' ]) . groups : if train . groupby ( [ 'Surname' , 'Fare' ]) . get_group (( sur , fare )) . shape [ 0 ] == 1 : pass else : train . loc [ ( train . Surname == sur ) & ( train . Fare == fare ), 'Familynum' ] = i i += 1 In [31]: fig , ( ax1 , ax2 ) = plt . subplots ( 1 , 2 , figsize = ( 18 , 6 )) familynum_size = train . groupby ( 'Familynum' ) . size () sns . distplot ( familynum_size , kde = False , ax = ax1 , bins = np . arange ( 2 , 7.5 , 1 ), axlabel = 'Size' ) ax1 . set_title ( 'Size of Families' ) familynum_perc = train . groupby ( 'Familynum' )[ 'Survived' ] . mean () sns . distplot ( familynum_perc , kde = False , ax = ax2 , bins = np . arange ( 0 , 1.05 , 0.1 ),) ax2 . set_yticks ( np . arange ( 0 , 61 , 10 )) ax2 . set_title ( 'Survival Rates of Families' ) plt . show () The graphic above shows that the size of the constructed families and the frequency of average survival rates for families. Since only complete families have been selected and bigger families have a higher probability of being split among test and train dataset, the distribution of complete families is probably right-skewed (positive skew). To correct for this bias, we will only consider families with two members. First: compare loners with couples In [32]: sample = train [( train . Company == 'Alone' ) | (( train . Familynum . notnull ()) & ( train . Familysize == 2 ))] fig , ( ax1 , ax2 ) = plt . subplots ( 1 , 2 , figsize = ( 18 , 6 )) sns . countplot ( 'Company' , data = sample , ax = ax1 , order = [ 'Company' , 'Alone' ]) sns . barplot ( x = 'Company' , y = 'Survived' , data = train , ax = ax2 , ci = False ) plt . show () Second: placebo test for couples The approach for the placebo test is to match all passengers who traveled in couples randomly with another. The idea is that if there is a special bond between couples which increases or decreases survival rates, then randomizing will change the distribution to a binomial distribution. What is needed? First, the actual distribution of survival outcomes for couples. Second, a distribution of survival outcomes for randomly matched couples. Third, a binomial distribution with a probability equal to the expected individual survival rate. Since the second and third step rely on randomness, the distributions are bootstrapped to match the expected ones rather than a special case of randomness. In [33]: def bootstrap ( df ): bs = pd . DataFrame ( columns = [ 0 , 0.5 , 1 ]) struc = df . Familynum . values for i in range ( 1000 ): df [ 'rand' ] = np . random . permutation ( struc ) bs . loc [ i ] = df . groupby ( 'rand' )[ 'Survived' ] . mean () . value_counts () . sort_index () return bs def bootstrap_binom (): bs = pd . DataFrame ( columns = [ 0 , 0.5 , 1 ]) for i in range ( 1000 ): bs . loc [ i ] = pd . Series ( np . random . binomial ( 1 , 0.571 , ( 42 , 2 )) . mean ( 1 )) . value_counts () . sort_index () return bs In [34]: sample = train [( train . Familynum . notnull ()) & ( train . Familysize == 2 )] . copy () # This correction is explained in #5 for iden in sample . Familynum . unique (): if sample [ sample . Familynum == iden ] . shape [ 0 ] == 2 : pass else : sample = sample [ sample . Familynum != iden ] bs = bootstrap ( sample ) bs_binom = bootstrap_binom () We need to other factors, the sample size and the individual survival rate: In [35]: print ( 'Individual survival rate: {:.3f} ' . format ( sample . Survived . mean ())) print ( 'Sample size: {:.0f} ' . format ( sample . shape [ 0 ])) Individual survival rate: 0.571 Sample size: 84 In [36]: fig , ( ax1 , ax2 , ax3 ) = plt . subplots ( 1 , 3 , figsize = ( 18 , 6 )) familynum_perc = sample . groupby ( 'Familynum' )[ 'Survived' ] . mean () . value_counts () . sort_index () . to_frame () . T sns . barplot ( data = familynum_perc , ax = ax1 ) ax1 . set_yticks ( np . arange ( 0 , 26 , 5 )) ax1 . set_title ( 'Survival Rates of Families \\n ' ) sns . barplot ( data = bs , ax = ax2 , ci = False ) ax2 . set_yticks ( np . arange ( 0 , 26 , 5 )) ax2 . set_title ( 'Bootstrapped Survival Rates of Families (randomized) \\n ' ) sns . barplot ( data = bs_binom , ax = ax3 , ci = False ) ax3 . set_yticks ( np . arange ( 0 , 26 , 5 )) ax3 . set_title ( 'Bootstrapped Binomial distribution (n=1, p=0.571, size=(42000, 2)) \\n ' ) plt . show () I'm not very sure what to make out these graphs. Certainly, the last two graphs look almost identical which would strengthen my belief, that there is some kind of structure in survival rates for families. But still, I have a lot of doubts concerning the methodology and the credibility of the results. Predicting Survival Finally, here is the section about predicting survival rates. In [37]: X_train = pd . get_dummies ( train [[ 'Sex' , 'Age' , 'SibSp' , 'Parch' , 'Fare' , 'Embarked' , 'Deck' , 'Familysize' , 'Company' , 'Title' ]] . copy ()) Y_train = train [ 'Survived' ] . copy () X_test = pd . get_dummies ( test [[ 'Sex' , 'Age' , 'SibSp' , 'Parch' , 'Fare' , 'Embarked' , 'Deck' , 'Familysize' , 'Company' , 'Title' ]] . copy ()) # Hotfix for missing columns X_test [ 'Deck_T' ] = 0 X_test [ 'Title_Nobility' ] = 0 In [38]: # Utility function to report best scores def report ( results , n_top = 3 ): for i in range ( 1 , n_top + 1 ): candidates = np . flatnonzero ( results [ 'rank_test_score' ] == i ) for candidate in candidates : print ( \"Model with rank: {0} \" . format ( i )) print ( \"Mean validation score: {0:.3f} (std: {1:.3f} )\" . format ( results [ 'mean_test_score' ][ candidate ], results [ 'std_test_score' ][ candidate ])) print ( \"Parameters: {0} \" . format ( results [ 'params' ][ candidate ])) print ( \"\" ) # specify classifier clf = RandomForestClassifier ( n_estimators = 1000 , min_samples_leaf = 1 , max_depth = None , n_jobs =- 1 ) # specify parameters and distributions to sample from param_dist = { # \"max_depth\": [3, None], \"max_features\" : sp_randint ( 1 , 11 ), \"min_samples_split\" : sp_randint ( 1 , 11 ), # \"min_samples_leaf\": sp_randint(1, 11), \"bootstrap\" : [ True , False ], \"criterion\" : [ \"gini\" , \"entropy\" ]} # run randomized search n_iter_search = 10 random_search = RandomizedSearchCV ( clf , param_distributions = param_dist , n_iter = n_iter_search , n_jobs =- 1 , cv = None , error_score = 0 ) start = time () random_search . fit ( X_train , Y_train ) print ( \"RandomizedSearchCV took %.2f seconds for %d candidates\" \" parameter settings.\" % (( time () - start ), n_iter_search )) report ( random_search . cv_results_ ) RandomizedSearchCV took 44.72 seconds for 10 candidates parameter settings. Model with rank: 1 Mean validation score: 0.822 (std: 0.010) Parameters: {'bootstrap': True, 'criterion': 'gini', 'max_features': 7, 'min_samples_split': 10} Model with rank: 2 Mean validation score: 0.819 (std: 0.012) Parameters: {'bootstrap': True, 'criterion': 'entropy', 'max_features': 8, 'min_samples_split': 8} Model with rank: 3 Mean validation score: 0.818 (std: 0.012) Parameters: {'bootstrap': True, 'criterion': 'entropy', 'max_features': 3, 'min_samples_split': 10} In [39]: clf = RandomForestClassifier ( n_estimators = 1000 , n_jobs =- 1 , max_features = 0.5 ) feat_imp = clf . fit ( X_train , Y_train ) . feature_importances_ sur_feat_imp = pd . DataFrame ( { 'Variables' : X_train . keys () . values , 'Feature Importance' : feat_imp } ) . sort_values ( 'Feature Importance' , ascending = False ) fig , ax = plt . subplots ( figsize = ( 18 , 12 )) sns . barplot ( y = 'Variables' , x = 'Feature Importance' , data = sur_feat_imp [: 20 ], ax = ax , orient = 'h' ) ax . set_title ( 'Feature Importance' ) ax . set_xlabel ( '' ) plt . show () In [40]: results = clf . predict ( X_test ) submission = pd . concat ( [ test [ 'PassengerId' ], pd . Series ( results , name = 'Survived' )]) submission . to_csv ( Path ( 'data' , 'results.csv' ), index = False ) if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) { var mathjaxscript = document.createElement('script'); mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#'; mathjaxscript.type = 'text/javascript'; mathjaxscript.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML'; mathjaxscript[(window.opera ? \"innerHTML\" : \"text\")] = \"MathJax.Hub.Config({\" + \" config: ['MMLorHTML.js'],\" + \" TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },\" + \" jax: ['input/TeX','input/MathML','output/HTML-CSS'],\" + \" extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],\" + \" displayAlign: 'center',\" + \" displayIndent: '0em',\" + \" showMathMenu: true,\" + \" tex2jax: { \" + \" inlineMath: [ ['$','$'] ], \" + \" displayMath: [ ['$$','$$'] ],\" + \" processEscapes: true,\" + \" preview: 'TeX',\" + \" }, \" + \" 'HTML-CSS': { \" + \" linebreaks: { automatic: true, width: '95% container' }, \" + \" styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }\" + \" } \" + \"}); \"; (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript); }","tags":"blog","url":"blog/the-tragedy-of-titanic.html"}]}